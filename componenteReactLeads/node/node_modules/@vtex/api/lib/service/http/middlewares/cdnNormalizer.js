"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constants_1 = require("../../../constants");
exports.cachingStrategies = [
    {
        forbidden: [],
        path: '/_v/private/',
        vary: [constants_1.SEGMENT_HEADER, constants_1.SESSION_HEADER],
    },
    {
        forbidden: [constants_1.SEGMENT_HEADER, constants_1.SESSION_HEADER],
        path: '/_v/public/',
        vary: [],
    },
    {
        forbidden: [constants_1.SESSION_HEADER],
        path: '/_v/segment',
        vary: [constants_1.SEGMENT_HEADER],
    },
];
async function cdnNormalizer(ctx, next) {
    const { path } = ctx;
    const strategy = exports.cachingStrategies.find(cachingStrategy => path.indexOf(cachingStrategy.path) === 0);
    if (strategy) {
        strategy.forbidden.forEach(headerName => {
            delete ctx.headers[headerName];
        });
    }
    await next();
}
exports.cdnNormalizer = cdnNormalizer;
